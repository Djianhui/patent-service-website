# 案例管理

<cite>
**Referenced Files in This Document**   
- [DefenseCasesView.vue](file://src/views/defense-support/DefenseCasesView.vue)
- [DefenseSimulationView.vue](file://src/views/defense-support/DefenseSimulationView.vue)
- [defenseSupport.ts](file://src/services/defenseSupport.ts)
- [DEFENSE_SUPPORT_API_INTEGRATION.md](file://DEFENSE_SUPPORT_API_INTEGRATION.md)
</cite>

## 目录
1. [引言](#引言)
2. [项目结构](#项目结构)
3. [核心组件](#核心组件)
4. [架构概述](#架构概述)
5. [详细组件分析](#详细组件分析)
6. [依赖分析](#依赖分析)
7. [性能考虑](#性能考虑)
8. [故障排除指南](#故障排除指南)
9. [结论](#结论)

## 引言
本文件详细说明了答辩案例管理功能的设计与实现，重点阐述了案例的分类体系、检索机制和归档逻辑。文档涵盖了从用户界面设计到后端API集成的完整技术实现，包括关键词搜索、状态筛选、分页功能以及文件解析等核心功能。

## 项目结构
答辩案例管理功能主要由视图组件、服务层和API文档三部分构成，形成了清晰的分层架构。

```mermaid
graph TB
subgraph "View Layer"
A[DefenseCasesView.vue]
B[DefenseSimulationView.vue]
end
subgraph "Service Layer"
C[defenseSupport.ts]
end
subgraph "API Documentation"
D[DEFENSE_SUPPORT_API_INTEGRATION.md]
end
A --> C
B --> C
C --> D
```

**Diagram sources**
- [DefenseCasesView.vue](file://src/views/defense-support/DefenseCasesView.vue)
- [DefenseSimulationView.vue](file://src/views/defense-support/DefenseSimulationView.vue)
- [defenseSupport.ts](file://src/services/defenseSupport.ts)
- [DEFENSE_SUPPORT_API_INTEGRATION.md](file://DEFENSE_SUPPORT_API_INTEGRATION.md)

**Section sources**
- [DefenseCasesView.vue](file://src/views/defense-support/DefenseCasesView.vue)
- [DefenseSimulationView.vue](file://src/views/defense-support/DefenseSimulationView.vue)
- [defenseSupport.ts](file://src/services/defenseSupport.ts)
- [DEFENSE_SUPPORT_API_INTEGRATION.md](file://DEFENSE_SUPPORT_API_INTEGRATION.md)

## 核心组件
核心组件包括答辩案例视图（DefenseCasesView.vue）、答辩模拟视图（DefenseSimulationView.vue）和服务层（defenseSupport.ts），共同实现了完整的案例管理功能。

**Section sources**
- [DefenseCasesView.vue](file://src/views/defense-support/DefenseCasesView.vue)
- [DefenseSimulationView.vue](file://src/views/defense-support/DefenseSimulationView.vue)
- [defenseSupport.ts](file://src/services/defenseSupport.ts)

## 架构概述
系统采用前后端分离架构，前端通过服务层与后端API进行通信，实现了答辩案例的全生命周期管理。

```mermaid
sequenceDiagram
participant User as "用户"
participant UI as "用户界面"
participant Service as "服务层"
participant Backend as "后端API"
User->>UI : 搜索/筛选案例
UI->>Service : 调用getDefenseList
Service->>Backend : 发送分页请求
Backend-->>Service : 返回案例列表
Service-->>UI : 返回解析后的数据
UI-->>User : 展示案例列表
User->>UI : 上传文件
UI->>Service : 调用uploadFile
Service->>Backend : 上传文件
Backend-->>Service : 返回文件URL
Service-->>UI : 返回URL
UI-->>User : 显示上传成功
User->>UI : 创建任务
UI->>Service : 调用createDefenseTask
Service->>Backend : 提交任务参数
Backend-->>Service : 返回任务状态
Service-->>UI : 返回结果
UI-->>User : 显示任务提交结果
```

**Diagram sources**
- [defenseSupport.ts](file://src/services/defenseSupport.ts)
- [DEFENSE_SUPPORT_API_INTEGRATION.md](file://DEFENSE_SUPPORT_API_INTEGRATION.md)

## 详细组件分析

### 答辩案例视图分析
DefenseCasesView.vue是答辩案例管理的主要界面组件，提供了案例的展示、搜索和创建功能。

```mermaid
classDiagram
class DefenseCasesView {
+searchKeyword : string
+showCreateDialog : boolean
+cases : Array
+filteredCases : Computed
+getStatusType(status) : string
+getStatusText(status) : string
+viewCase(case) : void
+startDefense(case) : void
+deleteCase(case) : void
+createCase() : void
}
DefenseCasesView --> "uses" ElementPlus : UI组件库
DefenseCasesView --> "uses" VueRouter : 路由导航
DefenseCasesView --> "uses" Utils : 工具函数
```

**Diagram sources**
- [DefenseCasesView.vue](file://src/views/defense-support/DefenseCasesView.vue)

**Section sources**
- [DefenseCasesView.vue](file://src/views/defense-support/DefenseCasesView.vue)

### 答辩支持服务分析
defenseSupport.ts服务层封装了与后端API的交互逻辑，提供了文件上传、任务创建和列表获取等核心功能。

#### 服务方法调用流程
```mermaid
flowchart TD
Start([开始]) --> GetList["getDefenseList(params)"]
GetList --> CreateRequest["创建请求数据"]
CreateRequest --> AddType["添加type=5"]
AddType --> AddState["添加state筛选"]
AddState --> SendRequest["发送POST /task/getPage"]
SendRequest --> ParseResponse["解析响应"]
ParseResponse --> ParseTaskJson["解析taskJson字段"]
ParseTaskJson --> ExtractType["提取typeSub"]
ExtractType --> ExtractPrompt["提取prompt"]
ExtractPrompt --> ExtractFileUrls["提取fileUrls"]
ExtractFileUrls --> TransformData["转换为前端格式"]
TransformData --> ReturnData["返回结果"]
ReturnData --> End([结束])
UploadFile["uploadFile(file)"] --> CreateFormData["创建FormData"]
CreateFormData --> AppendFile["添加文件"]
AppendFile --> SendUpload["发送POST /file/common/upload"]
SendUpload --> CheckResponse["检查响应"]
CheckResponse --> ReturnUrl["返回文件URL"]
CreateTask["createDefenseTask(data)"] --> PrepareData["准备任务数据"]
PrepareData --> SetType["type=5"]
PrepareData --> SetTypeSub["typeSub=functionType"]
PrepareData --> SendTask["发送POST /manus/task"]
SendTask --> HandleResult["处理结果"]
```

**Diagram sources**
- [defenseSupport.ts](file://src/services/defenseSupport.ts)
- [DEFENSE_SUPPORT_API_INTEGRATION.md](file://DEFENSE_SUPPORT_API_INTEGRATION.md)

**Section sources**
- [defenseSupport.ts](file://src/services/defenseSupport.ts)

### 答辩模拟视图分析
DefenseSimulationView.vue提供了更丰富的答辩支持功能，包括文件上传、任务创建和结果展示。

```mermaid
classDiagram
class DefenseSimulationView {
+selectedFunction : DefenseFunctionType
+uploadedFiles : Array
+defenseDescription : string
+searchKeyword : string
+statusFilter : string
+defenseList : Array
+pagination : Object
+loadData() : void
+handleFileChange(file) : void
+startDefenseTask() : void
+downloadPDF(item) : void
+downloadWord(item) : void
}
DefenseSimulationView --> DefenseCasesView : 继承相似功能
DefenseSimulationView --> defenseSupportService : 依赖服务层
DefenseSimulationView --> ElementPlus : UI组件库
```

**Diagram sources**
- [DefenseSimulationView.vue](file://src/views/defense-support/DefenseSimulationView.vue)

**Section sources**
- [DefenseSimulationView.vue](file://src/views/defense-support/DefenseSimulationView.vue)

## 依赖分析
系统各组件之间存在明确的依赖关系，形成了稳定的功能链条。

```mermaid
graph LR
A[DefenseCasesView.vue] --> C[defenseSupport.ts]
B[DefenseSimulationView.vue] --> C[defenseSupport.ts]
C[defenseSupport.ts] --> D[DEFENSE_SUPPORT_API_INTEGRATION.md]
C[defenseSupport.ts] --> E[http.ts]
C[defenseSupport.ts] --> F[utils.ts]
D[DEFENSE_SUPPORT_API_INTEGRATION.md] --> G[后端API]
```

**Diagram sources**
- [DefenseCasesView.vue](file://src/views/defense-support/DefenseCasesView.vue)
- [DefenseSimulationView.vue](file://src/views/defense-support/DefenseSimulationView.vue)
- [defenseSupport.ts](file://src/services/defenseSupport.ts)
- [DEFENSE_SUPPORT_API_INTEGRATION.md](file://DEFENSE_SUPPORT_API_INTEGRATION.md)

**Section sources**
- [defenseSupport.ts](file://src/services/defenseSupport.ts)

## 性能考虑
系统在设计时充分考虑了性能优化，特别是在UI渲染和数据处理方面。

### UI性能优化策略
```mermaid
flowchart TD
A[图片懒加载] --> B[设置loading=\"lazy\"]
B --> C[减少初始加载时间]
D[图片放大预览] --> E[使用preview-src-list]
E --> F[避免重复请求]
G[条件渲染] --> H[v-if控制PDF/Word按钮]
H --> I[避免无效DOM元素]
J[事件冒泡控制] --> K[@click.stop阻止冒泡]
K --> L[提高交互响应速度]
M[计算属性优化] --> N[filteredCases使用computed]
N --> O[避免重复计算]
```

**Diagram sources**
- [DefenseSimulationView.vue](file://src/views/defense-support/DefenseSimulationView.vue)

**Section sources**
- [DefenseSimulationView.vue](file://src/views/defense-support/DefenseSimulationView.vue)

## 故障排除指南
本节提供常见问题的解决方案，帮助开发者快速定位和解决问题。

### 常见问题及解决方案
| 问题现象 | 可能原因 | 解决方案 |
|---------|--------|---------|
| 文件上传失败 | 文件格式不支持 | 确认文件为PDF/DOC/DOCX格式 |
| | 文件大小超过限制 | 确保文件小于10MB |
| | Token过期 | 重新登录获取新Token |
| 任务列表为空 | 筛选条件过严 | 检查状态筛选和关键词搜索 |
| | 数据加载失败 | 检查网络连接和API状态 |
| PDF/Word下载失败 | 文件URL为空 | 确认任务已成功生成结果文件 |
| 图片加载失败 | URL无效 | 检查firstImgUrl字段是否正确 |

**Section sources**
- [defenseSupport.ts](file://src/services/defenseSupport.ts)
- [DEFENSE_SUPPORT_API_INTEGRATION.md](file://DEFENSE_SUPPORT_API_INTEGRATION.md)

## 结论
答辩案例管理功能通过清晰的分层架构和完善的API集成，实现了高效的案例管理。系统支持关键词搜索、多状态筛选和分页功能，结合从taskJson字段解析功能类型、描述信息和文件路径的技术实现，为用户提供了完整的答辩支持体验。UI设计注重用户体验，实现了图片展示、文件下载、放大预览和懒加载等优化策略，确保了系统的高性能和易用性。