# 技术方案报告功能

<cite>
**本文档引用文件**  
- [TechReportNewView.vue](file://src/views/tech-report/TechReportNewView.vue)
- [TechReportHistoryView.vue](file://src/views/tech-report/TechReportHistoryView.vue)
- [TechReportDetailView.vue](file://src/views/tech-report/TechReportDetailView.vue)
- [techReport.ts](file://src/services/techReport.ts)
- [techReportStore.ts](file://src/stores/techReport.ts)
- [TECH_REPORT_API.md](file://TECH_REPORT_API.md)
- [TECH_REPORT_HISTORY_API.md](file://TECH_REPORT_HISTORY_API.md)
- [TECH_REPORT_IMAGE_FEATURE.md](file://TECH_REPORT_IMAGE_FEATURE.md)
</cite>

## 目录
1. [报告创建流程](#报告创建流程)  
2. [历史记录管理](#历史记录管理)  
3. [报告详情查看](#报告详情查看)  
4. [后端异步交互机制](#后端异步交互机制)  
5. [技术实现细节](#技术实现细节)  
6. [系统架构图](#系统架构图)

## 报告创建流程

`TechReportNewView` 组件实现了技术方案报告的创建功能，用户通过输入技术领域描述来触发报告生成流程。该组件包含一个表单，要求用户输入至少5个字符的技术领域描述，并提供实时字数统计和验证功能。提交时，系统会检查用户登录状态，确保请求携带有效的认证令牌。

生成过程中，界面显示动态进度条和步骤指示器，模拟五阶段处理流程：分析技术内容、检索相关专利、评估技术特点、生成分析报告和完成输出。前端通过 `techReportService.generateReport` 方法与后端交互，传递包含 `prompt` 和 `type` 参数的请求体。若后端响应超时或返回异步处理状态，系统会提示用户报告已提交后台处理，并建议前往历史记录页面查看结果。

**Section sources**
- [TechReportNewView.vue](file://src/views/tech-report/TechReportNewView.vue#L1-L449)
- [techReport.ts](file://src/services/techReport.ts#L109-L145)

## 历史记录管理

`TechReportHistoryView` 组件负责展示和管理已生成的技术方案报告记录。页面提供关键词搜索、状态筛选（生成中、已完成、生成失败）和时间范围选择等过滤功能，支持分页显示和每页10/20/50/100条的可配置项。报告列表采用图文并茂的布局，左侧显示报告首页图片，右侧展示标题、技术领域、创建时间和摘要信息。

每个报告条目显示状态标签，使用不同颜色区分处理状态：黄色表示生成中，绿色表示已完成，红色表示生成失败。用户可对已完成的报告执行下载PDF或Word文件的操作，系统优先使用后端返回的直接URL进行下载，若不可用则回退到Blob方式。删除操作需要二次确认，防止误删。列表支持响应式设计，在移动端自动调整为上下布局。

**Section sources**
- [TechReportHistoryView.vue](file://src/views/tech-report/TechReportHistoryView.vue#L1-L655)
- [TECH_REPORT_HISTORY_API.md](file://TECH_REPORT_HISTORY_API.md#L1-L267)
- [TECH_REPORT_IMAGE_FEATURE.md](file://TECH_REPORT_IMAGE_FEATURE.md#L1-L42)

## 报告详情查看

`TechReportDetailView` 组件目前处于开发阶段，其模板结构已定义但功能尚未实现。根据设计规划，该页面将用于展示技术方案报告的完整内容，包括摘要、技术背景、创新点分析、技术优势等详细信息。未来计划集成ECharts图表库以可视化展示技术发展趋势、专利分布等数据，并提供报告内容的格式化渲染和多格式下载功能。

当前版本仅显示占位文本"技术方案报告详情页面开发中..."，表明该功能模块需要进一步开发完善。建议后续开发中参考 `TechReportHistoryView` 的数据获取模式，通过 `useTechReportStore` 从状态管理中获取报告详情，并实现内容的结构化展示。

**Section sources**
- [TechReportDetailView.vue](file://src/views/tech-report/TechReportDetailView.vue#L1-L37)

## 后端异步交互机制

技术方案报告功能采用异步任务处理模式与后端服务交互。当用户提交报告生成请求时，前端调用 `/manus/task` 接口，后端立即返回200状态码表示任务已接收，实际处理在后台异步执行。这种设计避免了长时间HTTP连接，提升了用户体验。

系统通过轮询机制监控任务状态。`TechReportHistoryView` 组件定期调用 `/task/getPage` 接口获取报告列表，其中包含每个任务的当前状态（0:生成中, 1:已完成, 2:失败）。状态变化由后端在任务完成时更新，前端通过定期刷新列表来反映最新状态。此外，系统还集成了SSE（Server-Sent Events）通知机制，可在报告生成完成后实时推送通知给用户，减少轮询开销。

错误处理机制完善，能区分网络错误、认证失败、参数错误等不同异常类型，并给出相应的用户提示。对于超时情况，系统明确告知用户"报告生成时间较长，已提交后台处理"，引导用户到历史记录页面查看结果。

**Section sources**
- [techReport.ts](file://src/services/techReport.ts#L109-L262)
- [TECH_REPORT_API.md](file://TECH_REPORT_API.md#L1-L262)
- [SSE_CONNECTION_MESSAGE_FILTER.md](file://SSE_CONNECTION_MESSAGE_FILTER.md#L1-L291)

## 技术实现细节

### 大文件上传处理
系统采用分块上传和异步处理策略应对大文件。文件上传通过 `techReportService.uploadFile` 方法实现，使用 `FormData` 封装文件数据并发送至 `/files/upload` 接口。上传过程支持进度提示，确保用户知晓上传状态。后端处理大文件时返回任务ID，前端通过轮询或SSE获取处理进度和结果。

### 图像特征提取
报告列表中的首页图片（`firstImgUrl`）由后端在报告生成过程中提取并返回。前端通过 `convertImageUrl` 工具函数处理图片URL，确保正确显示。图片展示支持懒加载、错误占位符和加载动画，提升用户体验。桌面端尺寸为280x210px，移动端为全宽280px高，支持点击放大预览功能。

### 报告模板管理
系统通过 `taskJson` 字段存储报告生成参数，其中包含 `prompt`（技术领域描述）和 `type`（报告类型）等信息。后端根据这些参数选择相应的报告模板进行内容生成。前端从 `taskJson` 解析出输入内容并动态生成报告标题，格式为"[技术领域]技术方案报告"。模板逻辑主要在后端实现，前端负责参数传递和结果展示。

**Section sources**
- [techReport.ts](file://src/services/techReport.ts#L227-L262)
- [techReportStore.ts](file://src/stores/techReport.ts#L1-L209)
- [TECH_REPORT_IMAGE_FEATURE.md](file://TECH_REPORT_IMAGE_FEATURE.md#L1-L42)

## 系统架构图

```mermaid
graph TD
A[用户界面] --> B[TechReportNewView]
A --> C[TechReportHistoryView]
A --> D[TechReportDetailView]
B --> E[techReportService.generateReport]
C --> F[techReportService.getReportList]
D --> G[techReportService.getReportDetail]
E --> H[/manus/task API]
F --> I[/task/getPage API]
G --> J[/tech-report/{id} API]
H --> K[后端任务队列]
I --> L[数据库]
J --> L
K --> M[报告生成引擎]
M --> N[存储服务]
N --> L
O[SSE服务] --> P[AppHeader通知]
K --> O
```

**Diagram sources**
- [TechReportNewView.vue](file://src/views/tech-report/TechReportNewView.vue#L1-L449)
- [TechReportHistoryView.vue](file://src/views/tech-report/TechReportHistoryView.vue#L1-L655)
- [techReport.ts](file://src/services/techReport.ts#L1-L345)

**Section sources**
- [TechReportNewView.vue](file://src/views/tech-report/TechReportNewView.vue#L1-L449)
- [TechReportHistoryView.vue](file://src/views/tech-report/TechReportHistoryView.vue#L1-L655)
- [techReport.ts](file://src/services/techReport.ts#L1-L345)