# 注册功能API集成文档

## 概述

本文档描述了用户注册功能与后端API的集成实现。注册界面现在使用验证码进行安全验证，简化了注册流程。

## API接口

### 1. 获取验证码
- **接口地址**: `/api/captchaImage`
- **请求方法**: `GET`
- **请求参数**: 无
- **返回数据**:
```json
{
  "code": 200,
  "msg": "操作成功",
  "captchaEnabled": true,
  "uuid": "51ae29f7e6fd4ef48c54fb698dd8d79a",
  "img": "/9j/4AAQSkZJRgABAgAAAQABAAD/2wBD..." // Base64编码的验证码图片（不含data:前缀）
}
```

**注意**: 后端返回的 `img` 字段是纯Base64字符串，前端需要添加 `data:image/jpeg;base64,` 前缀才能在 `<img>` 标签中显示。

### 2. 用户注册
- **接口地址**: `/api/register`
- **请求方法**: `POST`
- **请求参数**:
```json
{
  "username": "用户名",
  "password": "密码",
  "code": "验证码",
  "uuid": "验证码唯一标识"
}
```
- **返回数据**:
```json
{
  "code": 200,
  "msg": "注册成功"
}
```

## 前端实现

### 1. 修改的文件

#### src/services/auth.ts
- 新增 `CaptchaResponse` 接口定义
- 修改 `RegisterRequest` 接口，包含以下字段：
  - `username`: 用户名
  - `password`: 密码
  - `code`: 验证码
  - `uuid`: 验证码唯一标识
- 新增 `getCaptcha()` 方法：调用 `/api/captchaImage` 获取验证码
- 修改 `register()` 方法：调用 `/api/register` 进行用户注册

#### src/stores/auth.ts
- 修改 `register` action，接受新的参数结构
- 新增 `getCaptcha` action，用于获取验证码图片

#### src/views/auth/RegisterView.vue
- **简化注册表单**，只保留三个必填字段：
  - 用户名
  - 密码
  - 验证码
- **移除的字段**：
  - 邮箱
  - 手机号
  - 确认密码
  - 用户协议勾选
- **新增功能**：
  - 验证码图片展示
  - 点击验证码图片刷新
  - 页面加载时自动获取验证码
  - 注册失败后自动刷新验证码
- **保留功能**：
  - 密码强度提示器
  - 表单验证

### 2. 注册流程

1. **页面加载**
   - 自动调用 `/api/captchaImage` 获取验证码
   - 显示验证码图片

2. **用户输入**
   - 输入用户名（3-20个字符，只能包含字母、数字和下划线）
   - 输入密码（至少6位）
   - 输入4位验证码

3. **密码强度检测**
   - 实时显示密码强度（弱/中等/强）
   - 提供可视化进度条

4. **提交注册**
   - 验证表单所有字段
   - 调用 `/api/register` 提交注册信息
   - 成功后跳转到登录页面
   - 失败后自动刷新验证码并清空验证码输入

5. **验证码刷新**
   - 点击验证码图片可刷新
   - 注册失败后自动刷新

### 3. 表单验证规则

```typescript
{
  username: [
    { required: true, message: '请输入用户名', trigger: 'blur' },
    { min: 3, max: 20, message: '用户名长度在3到20个字符', trigger: 'blur' },
    { pattern: /^[a-zA-Z0-9_]+$/, message: '用户名只能包含字母、数字和下划线', trigger: 'blur' }
  ],
  password: [
    { required: true, message: '请设置密码', trigger: 'blur' },
    { min: 6, message: '密码长度不能少于6位', trigger: 'blur' }
  ],
  code: [
    { required: true, message: '请输入验证码', trigger: 'blur' },
    { validator: validateCode, trigger: 'blur' } // 验证码长度为4位
  ]
}
```

## 错误处理

### 1. 获取验证码失败
- 显示错误提示消息
- 用户可点击验证码区域重新获取

### 2. 注册失败
- 显示后端返回的错误信息
- 自动刷新验证码
- 清空验证码输入框
- 保留用户名和密码输入

### 3. 网络错误
- 捕获并显示友好的错误提示
- 提示用户检查网络连接

## 用户体验优化

1. **自动加载验证码**: 页面打开时自动获取验证码，无需用户手动操作
2. **验证码点击刷新**: 提供便捷的验证码刷新方式
3. **密码强度提示**: 实时显示密码强度，帮助用户设置安全密码
4. **表单验证**: 实时验证用户输入，提供即时反馈
5. **加载状态**: 注册过程中显示加载状态，防止重复提交
6. **错误恢复**: 注册失败后自动刷新验证码，优化用户体验
7. **响应式设计**: 适配移动端和桌面端

## 界面设计

1. **布局优化**: 居中显示，使用卡片式设计
2. **背景渐变**: 使用紫色渐变背景，提升视觉效果
3. **验证码区域**: 
   - 宽度120px，高度40px
   - 支持点击刷新
   - 悬停时有视觉反馈
4. **移动端适配**: 在小屏幕设备上验证码宽度调整为100px

## 测试要点

1. ✅ 页面加载时能否正常获取验证码
2. ✅ 点击验证码图片能否刷新
3. ✅ 表单验证是否正确
4. ✅ 密码强度提示是否正常工作
5. ✅ 注册成功后是否跳转到登录页
6. ✅ 注册失败后是否刷新验证码
7. ✅ 错误提示是否友好
8. ✅ 移动端适配是否正常

## 注意事项

1. **验证码图片格式处理**：后端返回的 [img](file://d:patent-service-websitesrcservicesauth.ts#L18-L18) 字段是纯Base64字符串（不包含 `data:` 前缀），前端在 [getCaptcha()](file://d:patent-service-websitesrcservicesauth.ts#L95-L115) 方法中会自动添加 `data:image/jpeg;base64,` 前缀，使其可以直接在 `<img>` 标签中显示
2. uuid在获取验证码和提交注册时必须一致
3. 注册失败后必须刷新验证码，因为验证码通常是一次性的
4. 密码最小长度为6位，可根据安全要求调整
5. 用户名只允许字母、数字和下划线，长度3-20个字符
6. 验证码默认为4位，可根据后端实际返回调整

## 后续优化建议

1. 可以添加密码强度要求的详细说明
2. 可以添加用户名可用性检查
3. 可以添加记住我功能（注册成功后自动登录）
4. 可以添加第三方登录选项
5. 可以添加邮箱/手机验证功能
